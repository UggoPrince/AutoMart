{"version":3,"sources":["../../../server/models/Cars.js"],"names":["dotenv","config","cloudinary","cloudiner","v2","cloud_name","process","env","CLOUDINARY_CLOUD_NAME","api_key","CLOUDINARY_API_KEY","api_secret","CLOUDINARY_API_SECRET","db","Database","Cars","carData","car_photo","uploadImage","uploadedImg","queryString","owner","state","status","price","title","manufacturer","model","body_type","url","query","result","rows","id","created_on","image_url","email","filePath","path","uploader","upload","folder","CLOUDINARY_AUTOMART_FOLDER","use_filename","err","min","max","field","car_id","value","ownerEmail","photos","updater"],"mappings":"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","sourcesContent":["/* eslint-disable linebreak-style */\r\n/* eslint-disable class-methods-use-this */\r\n/* eslint-disable camelcase */\r\nimport cloudiner from 'cloudinary';\r\nimport dotenv from 'dotenv';\r\nimport Database from '../database/Database';\r\n\r\ndotenv.config();\r\nconst cloudinary = cloudiner.v2;\r\n// cloudinary configuration\r\ncloudinary.config({\r\n  cloud_name: process.env.CLOUDINARY_CLOUD_NAME,\r\n  api_key: process.env.CLOUDINARY_API_KEY,\r\n  api_secret: process.env.CLOUDINARY_API_SECRET,\r\n});\r\n\r\nconst db = new Database();\r\n\r\nclass Cars {\r\n  async postAdvert(carData, car_photo) {\r\n    // check if user for this car exist\r\n    const uploadedImg = await this.uploadImage(car_photo);\r\n    const queryString = `\r\n      INSERT INTO cars (\r\n        owner, state, status, price, title, manufacturer, model, body_type, image_url\r\n        )\r\n      VALUES (\r\n        '${carData.owner}', '${carData.state}', '${carData.status}',\r\n        '${carData.price}', '${carData.title}', '${carData.manufacturer}',\r\n        '${carData.model}', '${carData.body_type}', '${uploadedImg.url}'\r\n      )\r\n      RETURNING *;\r\n    `;\r\n    const result = await db.query(queryString);\r\n    const {\r\n      id, created_on, state, status, price, title, manufacturer, model, body_type, image_url,\r\n    } = result.rows[0];\r\n    result.rows[0] = {\r\n      id,\r\n      email: carData.email,\r\n      created_on,\r\n      state,\r\n      status,\r\n      price,\r\n      title,\r\n      manufacturer,\r\n      model,\r\n      body_type,\r\n      image_url,\r\n    };\r\n    return result;\r\n  }\r\n\r\n  async uploadImage(car_photo) {\r\n    const filePath = car_photo.image_url.path;\r\n    const uploadedImg = await cloudinary.uploader.upload(filePath, {\r\n      folder: process.env.CLOUDINARY_AUTOMART_FOLDER,\r\n      use_filename: true,\r\n    }, (err, result) => result);\r\n    return uploadedImg;\r\n  }\r\n\r\n  async getCarById(id) {\r\n    const queryString = `SELECT * FROM cars WHERE id = '${id}';`;\r\n    const result = await db.query(queryString);\r\n    return result;\r\n  }\r\n\r\n  async getCarByOwner(owner) {\r\n    const queryString = `SELECT * FROM cars WHERE owner = ${owner};`;\r\n    const result = await db.query(queryString);\r\n    return result;\r\n  }\r\n\r\n  /* async getACar(id) {\r\n    const result = await this.getCarById(id);\r\n    return result;\r\n  } */\r\n\r\n  async getAllCars() {\r\n    const queryString = 'SELECT * FROM cars;';\r\n    const result = await db.query(queryString);\r\n    return result;\r\n  }\r\n\r\n  async getCarsByStatusAvailable() {\r\n    const queryString = 'SELECT * FROM cars WHERE status = \\'available\\';';\r\n    const result = db.query(queryString);\r\n    return result;\r\n  }\r\n\r\n  async getCarsByStatusAndPriceRange(min, max) {\r\n    const queryString = `SELECT * FROM cars WHERE status = 'available'\r\n      AND price BETWEEN ${min} AND ${max};`;\r\n    const result = db.query(queryString);\r\n    return result;\r\n  }\r\n\r\n  async getCarsByStatusAndState(field, state) {\r\n    const queryString = `SELECT * FROM cars WHERE status = 'available'\r\n      AND ${field} = '${state}';`;\r\n    const result = db.query(queryString);\r\n    return result;\r\n  }\r\n\r\n  async getCarsByStatusAndManufacturer(field, manufacturer) {\r\n    const queryString = `SELECT * FROM cars WHERE status = 'available'\r\n      AND ${field} ~* '${manufacturer}';`;\r\n    const result = db.query(queryString);\r\n    return result;\r\n  }\r\n\r\n  async updater(car_id, field, value, ownerEmail) {\r\n    const queryString = `UPDATE cars SET ${field} = '${value}'\r\n    WHERE id = '${car_id}' RETURNING *;`;\r\n    const result = await db.query(queryString);\r\n    const {\r\n      // eslint-disable-next-line no-unused-vars\r\n      id, created_on, state, status, price, title, manufacturer, model, body_type, photos,\r\n    } = result.rows[0];\r\n    result.rows[0] = {\r\n      id,\r\n      email: ownerEmail,\r\n      created_on,\r\n      state,\r\n      status,\r\n      price,\r\n      title,\r\n      manufacturer,\r\n      model,\r\n      body_type,\r\n      photos,\r\n    };\r\n    return result;\r\n  }\r\n\r\n  async updateStatus(carData) {\r\n    const result = await this.updater(carData.car_id, 'status', 'sold', carData.email);\r\n    return result;\r\n  }\r\n\r\n  async updatePrice(carData) {\r\n    const result = await this.updater(carData.car_id, 'price', carData.price, carData.email);\r\n    return result;\r\n  }\r\n\r\n  async deleteAdvert(car_id) {\r\n    const queryString = `DELETE FROM cars WHERE id ='${car_id}';`;\r\n    const result = await db.query(queryString);\r\n    return result;\r\n  }\r\n}\r\n\r\nexport default new Cars();\r\n"],"file":"Cars.js"}