{"version":3,"sources":["../../../server/middlewares/CarsMiddleware.js"],"names":["validateCreateAdvert","req","res","next","body","state","status","price","title","manufacturer","model","body_type","car_photo","img_url","empty","files","result","Validator","validateCreateAdvertFields","error","send","Response","owner","token","id","email","validateUpdateCarStatus","car_id","params","validateUpdateCarStatusFields","CarChecker","checkId","validateUpdateCarPrice","validatUpdateCarPriceFields","validateViewACar","validateViewSpecficCarParams","validateViewCars","rQuery","query","qLength","Object","keys","length","isZero","isOne","isTwo","isThree","validateViewUnsoldCarsQuery","validateViewAllCarsOfOwner","userId","parseInt","validateViewUnsoldNewCars","validateViewUnsoldCarsByManufacturer","min_price","max_price","validateViewUnsoldCarsInPriceRange","validateDeleteCar","validateDeleteACarParams","is_admin"],"mappings":"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","sourcesContent":["/* eslint-disable linebreak-style */\r\n/* eslint-disable camelcase */\r\nimport Validator from './validators/ValidateCar';\r\nimport CarChecker from './database_checkers/CarChecker';\r\nimport { errorInvalidQueryString } from '../helpers/errorHandlers';\r\n\r\nexport const validateCreateAdvert = async (req, res, next) => {\r\n  const {\r\n    state, status, price, title, manufacturer, model, body_type,\r\n  } = req.body;\r\n  let car_photo = {};\r\n  if (req.body.img_url) car_photo = { empty: false };\r\n  else if (req.files.img_url) car_photo = { empty: false };\r\n  else car_photo = { empty: true };\r\n  const result = Validator.validateCreateAdvertFields(\r\n    state, status, price, title, manufacturer, model, body_type, car_photo,\r\n  );\r\n  if (result.error) {\r\n    res.status(400).send(Validator.Response());\r\n  } else {\r\n    req.body.owner = req.token.id;\r\n    req.body.email = req.token.email;\r\n    next();\r\n  }\r\n};\r\n\r\nexport const validateUpdateCarStatus = async (req, res, next) => {\r\n  const { car_id } = req.params;\r\n  const result = Validator.validateUpdateCarStatusFields(car_id, req.body.status);\r\n  if (result.error) {\r\n    res.status(400).send(Validator.Response());\r\n  } else if (!await CarChecker.checkId(car_id)) {\r\n    res.status(404).send({\r\n      status: 404,\r\n      error: `Car with id (${car_id}) does not exist.`,\r\n    });\r\n  } else {\r\n    req.body.email = req.token.email;\r\n    next();\r\n  }\r\n};\r\n\r\nexport const validateUpdateCarPrice = async (req, res, next) => {\r\n  const { price } = req.body;\r\n  const { car_id } = req.params;\r\n  const result = Validator.validatUpdateCarPriceFields(car_id, price);\r\n  if (result.error) {\r\n    res.status(400).send(Validator.Response());\r\n  } else if (!await CarChecker.checkId(car_id)) {\r\n    res.status(404).send({\r\n      status: 404,\r\n      error: `Car with id (${car_id}) does not exist.`,\r\n    });\r\n  } else {\r\n    req.body.email = req.token.email;\r\n    next();\r\n  }\r\n};\r\n\r\nexport const validateViewACar = async (req, res, next) => {\r\n  const { car_id } = req.params;\r\n  const result = Validator.validateViewSpecficCarParams(car_id);\r\n  if (result.error) {\r\n    res.status(400).send(Validator.Response());\r\n  } else if (!await CarChecker.checkId(car_id)) {\r\n    res.status(404).send({\r\n      status: 404,\r\n      error: `Car with id (${car_id}) do not exist.`,\r\n    });\r\n  } else {\r\n    next();\r\n  }\r\n};\r\n\r\nexport const validateViewCars = (req, res, next) => {\r\n  const rQuery = req.query;\r\n  const qLength = Object.keys(req.query).length;\r\n  const isZero = qLength === 0;\r\n  const isOne = qLength > 0 && qLength === 1;\r\n  const isTwo = qLength > 0 && qLength === 2;\r\n  const isThree = qLength > 0 && qLength === 3;\r\n  if (isZero) {\r\n    req.qLength = 0;\r\n    next();\r\n  } else if (isOne) {\r\n    if (rQuery.status) { // getting all available cars\r\n      const result = Validator.validateViewUnsoldCarsQuery(rQuery.status);\r\n      if (result.error) {\r\n        res.status(400).send(Validator.Response());\r\n      } else {\r\n        req.qLength = 1;\r\n        next();\r\n      }\r\n    } else if (rQuery.owner) { // getting all cars of a particular owner\r\n      const result = Validator.validateViewAllCarsOfOwner(rQuery.owner);\r\n      const userId = parseInt(rQuery.owner, 10);\r\n      if (result.error) {\r\n        res.status(400).send(Validator.Response());\r\n      } else if (userId !== req.token.id) {\r\n        res.status(400).send({ status: 400, error: 'invalid owner.' });\r\n      } else {\r\n        req.qLength = 1;\r\n        next();\r\n      }\r\n    } else {\r\n      res.status(400).send(errorInvalidQueryString());\r\n    }\r\n  } else if (isTwo) {\r\n    if (rQuery.status && rQuery.state) {\r\n      const result = Validator.validateViewUnsoldNewCars(rQuery.status, rQuery.state);\r\n      if (result.error) {\r\n        res.status(400).send(Validator.Response());\r\n      } else {\r\n        req.qLength = 2;\r\n        next();\r\n      }\r\n    } else if (rQuery.status && rQuery.manufacturer) {\r\n      const result = Validator.validateViewUnsoldCarsByManufacturer(\r\n        rQuery.status, rQuery.manufacturer,\r\n      );\r\n      if (result.error) {\r\n        res.status(400).send(Validator.Response());\r\n      } else {\r\n        req.qLength = 2;\r\n        next();\r\n      }\r\n    } else res.status(400).send(errorInvalidQueryString());\r\n  } else if (isThree && rQuery.min_price && rQuery.max_price) {\r\n    const result = Validator.validateViewUnsoldCarsInPriceRange(\r\n      rQuery.status, rQuery.min_price, rQuery.max_price,\r\n    );\r\n    if (result.error) {\r\n      res.status(400).send(Validator.Response());\r\n    } else {\r\n      req.qLength = 3;\r\n      next();\r\n    }\r\n  } else {\r\n    res.status(400).send(errorInvalidQueryString());\r\n  }\r\n};\r\n\r\nexport const validateDeleteCar = async (req, res, next) => {\r\n  const { car_id } = req.params;\r\n  const result = Validator.validateDeleteACarParams(car_id);\r\n  if (result.error) {\r\n    res.status(400).send(Validator.Response());\r\n  } else if (!req.token.is_admin) {\r\n    res.status(403).send({\r\n      status: 403, error: 'You are not an admin. Only admin are allowed to delete an Advert',\r\n    });\r\n  } else if (!await CarChecker.checkId(car_id)) {\r\n    res.status(404).send({ status: 404, error: `Car with id (${car_id}) does not exist.` });\r\n  } else {\r\n    next();\r\n  }\r\n};\r\n"],"file":"CarsMiddleware.js"}