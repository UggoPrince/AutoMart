{"version":3,"sources":["../../../server/middlewares/CarsMiddleware.js"],"names":["validateCreateAdvert","req","res","next","body","state","status","price","title","manufacturer","model","body_type","car_photo","files","result","Validator","validateCreateAdvertFields","error","send","Response","owner","token","id","email","validateUpdateCarStatus","car_id","params","validateUpdateCarStatusFields","CarChecker","checkId","validateUpdateCarPrice","validatUpdateCarPriceFields","validateViewACar","validateViewSpecficCarParams","validateViewCars","rQuery","query","qLength","Object","keys","length","isZero","isOne","isTwo","isThree","is_admin","validateViewUnsoldCarsQuery","validateViewAllCarsOfOwner","userId","parseInt","validateViewUnsoldNewCars","validateViewUnsoldCarsByManufacturer","min_price","max_price","validateViewUnsoldCarsInPriceRange","validateDeleteCar","validateDeleteACarParams"],"mappings":";;;;;;;AAEA;;AACA;;AACA;;;;;;;;AAEO,IAAMA,oBAAoB;AAAA;AAAA;AAAA;AAAA;AAAA,0BAAG,iBAAOC,GAAP,EAAYC,GAAZ,EAAiBC,IAAjB;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,wBAG9BF,GAAG,CAACG,IAH0B,EAEhCC,KAFgC,aAEhCA,KAFgC,EAEzBC,MAFyB,aAEzBA,MAFyB,EAEjBC,KAFiB,aAEjBA,KAFiB,EAEVC,KAFU,aAEVA,KAFU,EAEHC,YAFG,aAEHA,YAFG,EAEWC,KAFX,aAEWA,KAFX,EAEkBC,SAFlB,aAEkBA,SAFlB;AAI5BC,YAAAA,SAJ4B,GAIhBX,GAAG,CAACY,KAJY;AAK5BC,YAAAA,MAL4B,GAKnBC,wBAAUC,0BAAV,CACbX,KADa,EACNC,MADM,EACEC,KADF,EACSC,KADT,EACgBC,YADhB,EAC8BC,KAD9B,EACqCC,SADrC,EACgDC,SADhD,CALmB;;AAQlC,gBAAIE,MAAM,CAACG,KAAX,EAAkB;AAChBf,cAAAA,GAAG,CAACI,MAAJ,CAAW,GAAX,EAAgBY,IAAhB,CAAqBH,wBAAUI,QAAV,EAArB;AACD,aAFD,MAEO;AACLlB,cAAAA,GAAG,CAACG,IAAJ,CAASgB,KAAT,GAAiBnB,GAAG,CAACoB,KAAJ,CAAUC,EAA3B;AACArB,cAAAA,GAAG,CAACG,IAAJ,CAASmB,KAAT,GAAiBtB,GAAG,CAACoB,KAAJ,CAAUE,KAA3B;AACApB,cAAAA,IAAI;AACL;;AAdiC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAH;;AAAA,kBAApBH,oBAAoB;AAAA;AAAA;AAAA,GAA1B;;;;AAiBA,IAAMwB,uBAAuB;AAAA;AAAA;AAAA;AAAA;AAAA,0BAAG,kBAAOvB,GAAP,EAAYC,GAAZ,EAAiBC,IAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAC7BG,YAAAA,MAD6B,GAClBL,GAAG,CAACG,IADc,CAC7BE,MAD6B;AAE7BmB,YAAAA,MAF6B,GAElBxB,GAAG,CAACyB,MAFc,CAE7BD,MAF6B;AAG/BX,YAAAA,MAH+B,GAGtBC,wBAAUY,6BAAV,CAAwCF,MAAxC,EAAgDnB,MAAhD,CAHsB;;AAAA,iBAIjCQ,MAAM,CAACG,KAJ0B;AAAA;AAAA;AAAA;;AAKnCf,YAAAA,GAAG,CAACI,MAAJ,CAAW,GAAX,EAAgBY,IAAhB,CAAqBH,wBAAUI,QAAV,EAArB;AALmC;AAAA;;AAAA;AAAA;AAAA,mBAMnBS,uBAAWC,OAAX,CAAmBJ,MAAnB,CANmB;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAOnCvB,YAAAA,GAAG,CAACI,MAAJ,CAAW,GAAX,EAAgBY,IAAhB,CAAqB;AACnBZ,cAAAA,MAAM,EAAE,GADW;AAEnBW,cAAAA,KAAK,yBAAkBQ,MAAlB;AAFc,aAArB;AAPmC;AAAA;;AAAA;AAYnCxB,YAAAA,GAAG,CAACG,IAAJ,CAASmB,KAAT,GAAiBtB,GAAG,CAACoB,KAAJ,CAAUE,KAA3B;AACApB,YAAAA,IAAI;;AAb+B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAH;;AAAA,kBAAvBqB,uBAAuB;AAAA;AAAA;AAAA,GAA7B;;;;AAiBA,IAAMM,sBAAsB;AAAA;AAAA;AAAA;AAAA;AAAA,0BAAG,kBAAO7B,GAAP,EAAYC,GAAZ,EAAiBC,IAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAC5BI,YAAAA,KAD4B,GAClBN,GAAG,CAACG,IADc,CAC5BG,KAD4B;AAE5BkB,YAAAA,MAF4B,GAEjBxB,GAAG,CAACyB,MAFa,CAE5BD,MAF4B;AAG9BX,YAAAA,MAH8B,GAGrBC,wBAAUgB,2BAAV,CAAsCN,MAAtC,EAA8ClB,KAA9C,CAHqB;;AAAA,iBAIhCO,MAAM,CAACG,KAJyB;AAAA;AAAA;AAAA;;AAKlCf,YAAAA,GAAG,CAACI,MAAJ,CAAW,GAAX,EAAgBY,IAAhB,CAAqBH,wBAAUI,QAAV,EAArB;AALkC;AAAA;;AAAA;AAAA;AAAA,mBAMlBS,uBAAWC,OAAX,CAAmBJ,MAAnB,CANkB;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAOlCvB,YAAAA,GAAG,CAACI,MAAJ,CAAW,GAAX,EAAgBY,IAAhB,CAAqB;AACnBZ,cAAAA,MAAM,EAAE,GADW;AAEnBW,cAAAA,KAAK,yBAAkBQ,MAAlB;AAFc,aAArB;AAPkC;AAAA;;AAAA;AAYlCxB,YAAAA,GAAG,CAACG,IAAJ,CAASmB,KAAT,GAAiBtB,GAAG,CAACoB,KAAJ,CAAUE,KAA3B;AACApB,YAAAA,IAAI;;AAb8B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAH;;AAAA,kBAAtB2B,sBAAsB;AAAA;AAAA;AAAA,GAA5B;;;;AAiBA,IAAME,gBAAgB;AAAA;AAAA;AAAA;AAAA;AAAA,0BAAG,kBAAO/B,GAAP,EAAYC,GAAZ,EAAiBC,IAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AACtBsB,YAAAA,MADsB,GACXxB,GAAG,CAACyB,MADO,CACtBD,MADsB;AAExBX,YAAAA,MAFwB,GAEfC,wBAAUkB,4BAAV,CAAuCR,MAAvC,CAFe;;AAAA,iBAG1BX,MAAM,CAACG,KAHmB;AAAA;AAAA;AAAA;;AAI5Bf,YAAAA,GAAG,CAACI,MAAJ,CAAW,GAAX,EAAgBY,IAAhB,CAAqBH,wBAAUI,QAAV,EAArB;AAJ4B;AAAA;;AAAA;AAAA;AAAA,mBAKZS,uBAAWC,OAAX,CAAmBJ,MAAnB,CALY;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAM5BvB,YAAAA,GAAG,CAACI,MAAJ,CAAW,GAAX,EAAgBY,IAAhB,CAAqB;AACnBZ,cAAAA,MAAM,EAAE,GADW;AAEnBW,cAAAA,KAAK,yBAAkBQ,MAAlB;AAFc,aAArB;AAN4B;AAAA;;AAAA;AAW5BtB,YAAAA,IAAI;;AAXwB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAH;;AAAA,kBAAhB6B,gBAAgB;AAAA;AAAA;AAAA,GAAtB;;;;AAeA,IAAME,gBAAgB,GAAG,SAAnBA,gBAAmB,CAACjC,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AAClD,MAAMgC,MAAM,GAAGlC,GAAG,CAACmC,KAAnB;AACA,MAAMC,OAAO,GAAGC,MAAM,CAACC,IAAP,CAAYtC,GAAG,CAACmC,KAAhB,EAAuBI,MAAvC;AACA,MAAMC,MAAM,GAAGJ,OAAO,KAAK,CAA3B;AACA,MAAMK,KAAK,GAAGL,OAAO,GAAG,CAAV,IAAeA,OAAO,KAAK,CAAzC;AACA,MAAMM,KAAK,GAAGN,OAAO,GAAG,CAAV,IAAeA,OAAO,KAAK,CAAzC;AACA,MAAMO,OAAO,GAAGP,OAAO,GAAG,CAAV,IAAeA,OAAO,KAAK,CAA3C;;AACA,MAAII,MAAJ,EAAY;AACV,QAAI,CAACxC,GAAG,CAACoB,KAAJ,CAAUwB,QAAf,EAAyB;AACvB3C,MAAAA,GAAG,CAACI,MAAJ,CAAW,GAAX,EAAgBY,IAAhB,CAAqB;AACnBZ,QAAAA,MAAM,EAAE,GADW;AAEnBW,QAAAA,KAAK,EAAE;AAFY,OAArB;AAID,KALD,MAKO;AACLhB,MAAAA,GAAG,CAACoC,OAAJ,GAAc,CAAd;AACAlC,MAAAA,IAAI;AACL;AACF,GAVD,MAUO,IAAIuC,KAAJ,EAAW;AAChB,QAAIP,MAAM,CAAC7B,MAAX,EAAmB;AAAE;AACnB,UAAMQ,MAAM,GAAGC,wBAAU+B,2BAAV,CAAsCX,MAAM,CAAC7B,MAA7C,CAAf;;AACA,UAAIQ,MAAM,CAACG,KAAX,EAAkB;AAChBf,QAAAA,GAAG,CAACI,MAAJ,CAAW,GAAX,EAAgBY,IAAhB,CAAqBH,wBAAUI,QAAV,EAArB;AACD,OAFD,MAEO;AACLlB,QAAAA,GAAG,CAACoC,OAAJ,GAAc,CAAd;AACAlC,QAAAA,IAAI;AACL;AACF,KARD,MAQO,IAAIgC,MAAM,CAACf,KAAX,EAAkB;AAAE;AACzB,UAAMN,OAAM,GAAGC,wBAAUgC,0BAAV,CAAqCZ,MAAM,CAACf,KAA5C,CAAf;;AACA,UAAM4B,MAAM,GAAGC,QAAQ,CAACd,MAAM,CAACf,KAAR,EAAe,EAAf,CAAvB;;AACA,UAAIN,OAAM,CAACG,KAAX,EAAkB;AAChBf,QAAAA,GAAG,CAACI,MAAJ,CAAW,GAAX,EAAgBY,IAAhB,CAAqBH,wBAAUI,QAAV,EAArB;AACD,OAFD,MAEO,IAAI6B,MAAM,KAAK/C,GAAG,CAACoB,KAAJ,CAAUC,EAAzB,EAA6B;AAClCpB,QAAAA,GAAG,CAACI,MAAJ,CAAW,GAAX,EAAgBY,IAAhB,CAAqB;AAAEZ,UAAAA,MAAM,EAAE,GAAV;AAAeW,UAAAA,KAAK,EAAE;AAAtB,SAArB;AACD,OAFM,MAEA;AACLhB,QAAAA,GAAG,CAACoC,OAAJ,GAAc,CAAd;AACAlC,QAAAA,IAAI;AACL;AACF,KAXM,MAWA;AACLD,MAAAA,GAAG,CAACI,MAAJ,CAAW,GAAX,EAAgBY,IAAhB,CAAqB,6CAArB;AACD;AACF,GAvBM,MAuBA,IAAIyB,KAAJ,EAAW;AAChB,QAAIR,MAAM,CAAC7B,MAAP,IAAiB6B,MAAM,CAAC9B,KAA5B,EAAmC;AACjC,UAAMS,QAAM,GAAGC,wBAAUmC,yBAAV,CAAoCf,MAAM,CAAC7B,MAA3C,EAAmD6B,MAAM,CAAC9B,KAA1D,CAAf;;AACA,UAAIS,QAAM,CAACG,KAAX,EAAkB;AAChBf,QAAAA,GAAG,CAACI,MAAJ,CAAW,GAAX,EAAgBY,IAAhB,CAAqBH,wBAAUI,QAAV,EAArB;AACD,OAFD,MAEO;AACLlB,QAAAA,GAAG,CAACoC,OAAJ,GAAc,CAAd;AACAlC,QAAAA,IAAI;AACL;AACF,KARD,MAQO,IAAIgC,MAAM,CAAC7B,MAAP,IAAiB6B,MAAM,CAAC1B,YAA5B,EAA0C;AAC/C,UAAMK,QAAM,GAAGC,wBAAUoC,oCAAV,CACbhB,MAAM,CAAC7B,MADM,EACE6B,MAAM,CAAC1B,YADT,CAAf;;AAGA,UAAIK,QAAM,CAACG,KAAX,EAAkB;AAChBf,QAAAA,GAAG,CAACI,MAAJ,CAAW,GAAX,EAAgBY,IAAhB,CAAqBH,wBAAUI,QAAV,EAArB;AACD,OAFD,MAEO;AACLlB,QAAAA,GAAG,CAACoC,OAAJ,GAAc,CAAd;AACAlC,QAAAA,IAAI;AACL;AACF,KAVM,MAUAD,GAAG,CAACI,MAAJ,CAAW,GAAX,EAAgBY,IAAhB,CAAqB,6CAArB;AACR,GApBM,MAoBA,IAAI0B,OAAO,IAAIT,MAAM,CAACiB,SAAlB,IAA+BjB,MAAM,CAACkB,SAA1C,EAAqD;AAC1D,QAAMvC,QAAM,GAAGC,wBAAUuC,kCAAV,CACbnB,MAAM,CAAC7B,MADM,EACE6B,MAAM,CAACiB,SADT,EACoBjB,MAAM,CAACkB,SAD3B,CAAf;;AAGA,QAAIvC,QAAM,CAACG,KAAX,EAAkB;AAChBf,MAAAA,GAAG,CAACI,MAAJ,CAAW,GAAX,EAAgBY,IAAhB,CAAqBH,wBAAUI,QAAV,EAArB;AACD,KAFD,MAEO;AACLlB,MAAAA,GAAG,CAACoC,OAAJ,GAAc,CAAd;AACAlC,MAAAA,IAAI;AACL;AACF,GAVM,MAUA;AACLD,IAAAA,GAAG,CAACI,MAAJ,CAAW,GAAX,EAAgBY,IAAhB,CAAqB,6CAArB;AACD;AACF,CAzEM;;;;AA2EA,IAAMqC,iBAAiB;AAAA;AAAA;AAAA;AAAA;AAAA,0BAAG,kBAAOtD,GAAP,EAAYC,GAAZ,EAAiBC,IAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AACvBsB,YAAAA,MADuB,GACZxB,GAAG,CAACyB,MADQ,CACvBD,MADuB;AAEzBX,YAAAA,MAFyB,GAEhBC,wBAAUyC,wBAAV,CAAmC/B,MAAnC,CAFgB;;AAAA,iBAG3BX,MAAM,CAACG,KAHoB;AAAA;AAAA;AAAA;;AAI7Bf,YAAAA,GAAG,CAACI,MAAJ,CAAW,GAAX,EAAgBY,IAAhB,CAAqBH,wBAAUI,QAAV,EAArB;AAJ6B;AAAA;;AAAA;AAAA,gBAKnBlB,GAAG,CAACoB,KAAJ,CAAUwB,QALS;AAAA;AAAA;AAAA;;AAM7B3C,YAAAA,GAAG,CAACI,MAAJ,CAAW,GAAX,EAAgBY,IAAhB,CAAqB;AACnBZ,cAAAA,MAAM,EAAE,GADW;AACNW,cAAAA,KAAK,EAAE;AADD,aAArB;AAN6B;AAAA;;AAAA;AAAA;AAAA,mBASbW,uBAAWC,OAAX,CAAmBJ,MAAnB,CATa;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAU7BvB,YAAAA,GAAG,CAACI,MAAJ,CAAW,GAAX,EAAgBY,IAAhB,CAAqB;AAAEZ,cAAAA,MAAM,EAAE,GAAV;AAAeW,cAAAA,KAAK,yBAAkBQ,MAAlB;AAApB,aAArB;AAV6B;AAAA;;AAAA;AAY7BtB,YAAAA,IAAI;;AAZyB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAH;;AAAA,kBAAjBoD,iBAAiB;AAAA;AAAA;AAAA,GAAvB","sourcesContent":["/* eslint-disable linebreak-style */\r\n/* eslint-disable camelcase */\r\nimport Validator from './validators/ValidateCar';\r\nimport CarChecker from './database_checkers/CarChecker';\r\nimport { errorInvalidQueryString } from '../helpers/errorHandlers';\r\n\r\nexport const validateCreateAdvert = async (req, res, next) => {\r\n  const {\r\n    state, status, price, title, manufacturer, model, body_type,\r\n  } = req.body;\r\n  const car_photo = req.files;\r\n  const result = Validator.validateCreateAdvertFields(\r\n    state, status, price, title, manufacturer, model, body_type, car_photo,\r\n  );\r\n  if (result.error) {\r\n    res.status(400).send(Validator.Response());\r\n  } else {\r\n    req.body.owner = req.token.id;\r\n    req.body.email = req.token.email;\r\n    next();\r\n  }\r\n};\r\n\r\nexport const validateUpdateCarStatus = async (req, res, next) => {\r\n  const { status } = req.body;\r\n  const { car_id } = req.params;\r\n  const result = Validator.validateUpdateCarStatusFields(car_id, status);\r\n  if (result.error) {\r\n    res.status(400).send(Validator.Response());\r\n  } else if (!await CarChecker.checkId(car_id)) {\r\n    res.status(404).send({\r\n      status: 404,\r\n      error: `Car with id (${car_id}) does not exist.`,\r\n    });\r\n  } else {\r\n    req.body.email = req.token.email;\r\n    next();\r\n  }\r\n};\r\n\r\nexport const validateUpdateCarPrice = async (req, res, next) => {\r\n  const { price } = req.body;\r\n  const { car_id } = req.params;\r\n  const result = Validator.validatUpdateCarPriceFields(car_id, price);\r\n  if (result.error) {\r\n    res.status(400).send(Validator.Response());\r\n  } else if (!await CarChecker.checkId(car_id)) {\r\n    res.status(404).send({\r\n      status: 404,\r\n      error: `Car with id (${car_id}) does not exist.`,\r\n    });\r\n  } else {\r\n    req.body.email = req.token.email;\r\n    next();\r\n  }\r\n};\r\n\r\nexport const validateViewACar = async (req, res, next) => {\r\n  const { car_id } = req.params;\r\n  const result = Validator.validateViewSpecficCarParams(car_id);\r\n  if (result.error) {\r\n    res.status(400).send(Validator.Response());\r\n  } else if (!await CarChecker.checkId(car_id)) {\r\n    res.status(404).send({\r\n      status: 404,\r\n      error: `Car with id (${car_id}) do not exist.`,\r\n    });\r\n  } else {\r\n    next();\r\n  }\r\n};\r\n\r\nexport const validateViewCars = (req, res, next) => {\r\n  const rQuery = req.query;\r\n  const qLength = Object.keys(req.query).length;\r\n  const isZero = qLength === 0;\r\n  const isOne = qLength > 0 && qLength === 1;\r\n  const isTwo = qLength > 0 && qLength === 2;\r\n  const isThree = qLength > 0 && qLength === 3;\r\n  if (isZero) {\r\n    if (!req.token.is_admin) {\r\n      res.status(403).send({\r\n        status: 403,\r\n        error: 'You are not an admin. Only admins are allowed to view both sold and unsold cars.',\r\n      });\r\n    } else {\r\n      req.qLength = 0;\r\n      next();\r\n    }\r\n  } else if (isOne) {\r\n    if (rQuery.status) { // getting all available cars\r\n      const result = Validator.validateViewUnsoldCarsQuery(rQuery.status);\r\n      if (result.error) {\r\n        res.status(400).send(Validator.Response());\r\n      } else {\r\n        req.qLength = 1;\r\n        next();\r\n      }\r\n    } else if (rQuery.owner) { // getting all cars of a particular owner\r\n      const result = Validator.validateViewAllCarsOfOwner(rQuery.owner);\r\n      const userId = parseInt(rQuery.owner, 10);\r\n      if (result.error) {\r\n        res.status(400).send(Validator.Response());\r\n      } else if (userId !== req.token.id) {\r\n        res.status(400).send({ status: 400, error: 'invalid owner.' });\r\n      } else {\r\n        req.qLength = 1;\r\n        next();\r\n      }\r\n    } else {\r\n      res.status(400).send(errorInvalidQueryString());\r\n    }\r\n  } else if (isTwo) {\r\n    if (rQuery.status && rQuery.state) {\r\n      const result = Validator.validateViewUnsoldNewCars(rQuery.status, rQuery.state);\r\n      if (result.error) {\r\n        res.status(400).send(Validator.Response());\r\n      } else {\r\n        req.qLength = 2;\r\n        next();\r\n      }\r\n    } else if (rQuery.status && rQuery.manufacturer) {\r\n      const result = Validator.validateViewUnsoldCarsByManufacturer(\r\n        rQuery.status, rQuery.manufacturer,\r\n      );\r\n      if (result.error) {\r\n        res.status(400).send(Validator.Response());\r\n      } else {\r\n        req.qLength = 2;\r\n        next();\r\n      }\r\n    } else res.status(400).send(errorInvalidQueryString());\r\n  } else if (isThree && rQuery.min_price && rQuery.max_price) {\r\n    const result = Validator.validateViewUnsoldCarsInPriceRange(\r\n      rQuery.status, rQuery.min_price, rQuery.max_price,\r\n    );\r\n    if (result.error) {\r\n      res.status(400).send(Validator.Response());\r\n    } else {\r\n      req.qLength = 3;\r\n      next();\r\n    }\r\n  } else {\r\n    res.status(400).send(errorInvalidQueryString());\r\n  }\r\n};\r\n\r\nexport const validateDeleteCar = async (req, res, next) => {\r\n  const { car_id } = req.params;\r\n  const result = Validator.validateDeleteACarParams(car_id);\r\n  if (result.error) {\r\n    res.status(400).send(Validator.Response());\r\n  } else if (!req.token.is_admin) {\r\n    res.status(403).send({\r\n      status: 403, error: 'You are not an admin. Only admin are allowed to delete an Advert',\r\n    });\r\n  } else if (!await CarChecker.checkId(car_id)) {\r\n    res.status(404).send({ status: 404, error: `Car with id (${car_id}) does not exist.` });\r\n  } else {\r\n    next();\r\n  }\r\n};\r\n"],"file":"CarsMiddleware.js"}